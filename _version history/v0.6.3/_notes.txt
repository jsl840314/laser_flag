Laser Flag, by Jesse Stuart Leitch

Version History:
v0.6.3  02/15/2023  finished all listed below
                    some map edits to reflect the new base system
v0.6.2  02/15/2023  brought back team bases concept. Still need to reinstate
                        Elimination mode, update Rules screen, and make team
                        base sprites. Refer to teams G and M as 1 and 2 ingame.
v0.6.1  02/15/2023  cleaned up map loader a bit
v0.6.0  02/15/2023  ALPHA?
                    made a simple map loader so friends can easily test them
                    changed map loader dictionary so "B" makes a base
v0.5.8  02/15/2023  eliminated concept of "team bases" entirely
                    completed rules screen
v0.5.7  02/15/2023  implemented most of rules screen; eliminating team bases before proceeding
v0.5.6  02/15/2023  made the game pause after each shot so you can read the roll info
                        any click or keypress will continue
                        need to add a message for the user
v0.5.5  02/15/2023  made it so only relevant cover is included in target status
                        still need to clean it up so it displays a nice string though
v0.5.4  02/14/2023  started adding a rules screen
                    added cover info to status boxes
                    gave buttons/labels the ability to show 3 lines
v0.5.3  02/14/2023  revised overwatch rules; reaction shots are triggered by
                        firing as well as moving
                    more image revisions; probably good enough for alpha
v0.5.2  02/14/2023  changed rule for scouts: eliminated free move after shot but
                        they can now climb onto elevated ground without
                        consuming the remainder of the AP
                    implemented alt team colors
                    new unit icons
                    cleaned up a few more images
v0.5.1  02/14/2023  had some bugs in the overwatch system so moved all unit
                        firing action into one base method, to be overridden by
                        sniper and scout classes. Seems to work smoothly.
                    revised unit icons and added alt color polygons to class defs
v0.5.0  02/13/2023  basic overwatch rules implemented
v0.4.6  02/13/2023  moved lf_game.tiles to game_map.all_tiles
                    moved lf_game.walls to game_map.all_walls
                    added function to eliminate units if they have no bases
                        - for assault (one team has a recharging base) or
                          elimination (no recharging bases on the map) rules
v0.4.5  02/13/2023  cleaned up conditionals so that units with no laser can't
                        click targets
                    simplified Grunt rules: "everything +/-3 instead of 2"
v0.4.4  02/13/2023  invented Grunt overwatch rules (3 shots but +3 penalty)
v0.4.3  02/13/2023  added some additional methods to the Unit superclass so
                        that each subclass has a place to implement bonuses
                    changed status indicator rules:
                        - black dots indicate remaining AP
                        - cyan / red to indicate whether unit can move
                        - laser recharge symbol if unit cannot fire
                    added option to view enemy sight lines
v0.4.2  02/12/2023  linked all color settings including unit circle
                    tweaked hit/miss report message and timer
                    fixed so target symbol disappears immediately after firing
v0.4.1  02/12/2023  added all roll calculations to status labels - still need
                    to actually implement them in the roll however
v0.4.0  02/12/2023  refactored unit and target selection methods
                    implemented roll calculation method and dictionary
                    cover & elevation systems seem to work
                    still need to report to labels
v0.3.6  02/12/2023  moved determine_range() and determine_los() calls from
                        main game loop into to the unit_move() method and stored
                        those values with unit class variables
v0.3.5  02/12/2023  moved build_teams to the game_map module
                    changed team-related buttons to dictionary entries
                    started refactoring _on_select_unit and _on_target_unit
                    moved Tile class to its own module
v0.3.4  02/11/2023  fixed the background lasers
v0.3.3  02/11/2023  organized the haphazard tile.point system
                    but something broke the background lasers
v0.3.2  02/11/2023  implemented scoring
v0.3.1  02/11/2023  put in some code to read version info from this file
v0.3.0  02/11/2023  implemented laser hits (on units) and recharging
v0.2.1  02/10/2023  moved the "move unit" method to the unit class
                    added a little D6 function
                    moved selection and deselection into their own methods
v0.2.0  02/10/2023  implemented flags in the LOS functions to decide corner
                            permissiveness
                    converted ASCII reader to a dictionary in settings
                    changed self.teams from a list to a dictionary
v0.1.1  02/10/2023  line-of-sight seems to be working properly
v0.1.0  02/10/2023  implemented basic line-of-sight; still buggy
v0.0.2  02/09/2023  a bit more refactoring; fixed a bug with climbing units
v0.0.1  02/08/2023  refactored a bunch of shit
v0.0.0  02/08/2023  map-loading and movement rules complete


################################################################################
ROADMAP:
################################################################################

just need to make a simple map loader

#############################################
FIRST PLAYABLE ALPHA READY FOR FRIEND TESTING
#############################################

holy FUCK I just realized that shooting bases NEVER needs to happen:
    if you occupy all enemy bases and deactivate all their lasers, you win
    otherwise first to a set score wins. Just need to implement 3 victory conditions:
        - map score limit hit
        - all enemies eliminated
        - checkmate: all enemy bases occupied and all enemy lasers deactivated

holy FUCK again, I just realized that bases don't need to be assigned to teams:
   any unit can recharge at any base
      use all 6 team colors in base design; allow base to sit on floor or cover
   all maps must include at least one base



Need to add victory conditions

revise line of sight to draw from edge midpoints as well; but only from the nearest 5 points:
    _Tile class should contain 8 dictionaries, each one containing a set of
        corner points
    LOS calculator just needs another elif to generate a new set of test lines

build a main menu / map loader

build a map editor

expand map format to include rule modifications
    put it in JSON format maybe

Allow for various map sizes & shapes
    max 21 tiles
    min needs to be play tested, maybe 11

################################################
When all of the above are complete, issue v1.0.0
################################################

Maybe: fog of war option

Maybe: add sounds and music
    Mickey and Jeremy Ensley and Eric Morin help?


################################################################################
DESIGN GOALS:
################################################################################

A game that combines:   XCom-style cover tactics
                        the perfect information of Into The Breach
                        BUT is a two-player game

################################################################################
RULES:
################################################################################

Players take turns controlling teams of units in a game of laser tag. Each unit may
perform three actions per turn. An action point (AP) may be used to move a certain
number of squares, or to fire a laser. Firing consumes the remainder of that unit's
turn (except for Sniper units; see below).

The map consists of floor, cover, and walls. A unit adjacent to a wall or cover is
IN COVER in a 180° arc in that direction. Units may climb on cover tiles to an
ELEVATED position, but climbing consumes the remainder of one AP (except for Scouts,
who can climb freely). An elevated unit may still take cover next to walls.

Lasers may be fired at any opposing unit within line-of-sight. A successful hit
(determined by by the sum of two D6 dice) is worth one point, and deactivates the
target's laser. To reactivate a laser, the unit must step on a base tile.

A unit that retains some AP at the end of the turn may return fire during enemy
moves; but with a roll penalty. If multiple units have line of sight, they will all
fire until a hit is scored. Units only fire once per overwatch round. Available snap
shots are triggered any time a unit moves or fires.

Plain unit: move 5 squares per AP
            roll 7 or greater to hit
            +2 defense bonus if in cover
            -2 defense penalty if on elevated ground
            -2 attack bonus (low rolls are better) if on elevated ground
            max 2 AP carried into enemy turn for snapshots
            +2 attack penalty for snap shots

These sub-classes use the same rules with these exceptions:

    Grunt:  +3 defense bonus if in cover
            -3 defense penalty if on elevated ground
            -3 attack bonus if on elevated ground     # maybe change those to 1?
            max 3 AP carry over for snap shots
            +3 attack penalty for snap shots

    Sniper: move 4 squares per AP
            roll 6 or greater to hit
            firing only consumes 1 AP, but must stay in place after firing

    Scout:  move 6 squares per AP
            roll 8 or greater to hit
            no penalty for climbing onto cover



Wall:  blocks movement and line-of-sight

Cover: slows movement except for scouts

Level: no movement restrictions


Universal Base: any unit may recharge
                its laser here


     Team Base: only one team's units
                can use this base


NOTE: not all maps include bases for both
      teams, or universal bases. If there
      is no valid recharging base for its
      team, a unit hit by a laser is
      disqualified and removed from the
      room.


Victory conditions (not implemented in code yet):

CHECKMATE  : deactivate all enemy lasers and
             stand on any bases they can use
ELIMINATION: disqualify all enemy units
SCORE      : first team to a preset score



Status icons:

  unit elevated          cover direction

  remaining AP           snapshot counter

  laser uncharged        laser charging







Several possible game modes depending on the map:

    Capture the Flag: each team has at least one base
    Victory conditions: all enemy lasers are discharged and bases are blocked AND/OR
                        first to a set score AND/OR
                        highest score after set number of turns AND/OR



    Assault: only one team has a base
    Victory conditions:  Capture the Flag victory conditions AND/OR:
                            team with no base is on offense
                            other team is on defense
                            offense tries to score as many points
                                as possible before all their units
                                are eliminated

    Elimination: no bases on the map
    Victory conditions: Capture the Flag victory conditions AND/OR:
                            last man standing wins

Map data will include turn limits and target scores
    - maps can be asymmetrical, so allow different target scores per team



Line-of-sight rules:
    If a line can be drawn from any part of a unit's square to any part of a
    target tile, without a wall blocking it, then the unit can hit that tile
    with his laser.

 (tentative algorithm):
    create 25 lines:
        from shooter's 4 corners and center to target's 4 corners and center
        if any line does not collide with a wall, LOS is established
    BASES hang from the ceiling and do not block any LOS




RULE-SET "STORY":

A normal laser that has fired takes a moment to cool
down, so it's inactive for the rest of the turn.

Grunts and Basic units need to take their
time aiming, so they can't move after firing.

Scouts can run while firing, but aren't very good shots.

Snipers are good shots with their special lasers that don't need to cool down;
but they are slow movers, and like other units they cannot move after firing.

Units on overwatch have to react quickly to enemy moves, so they suffer an
accuracy penalty. However, their laser has time to cool down between shots.




HIT DICE:
    roll 2D6 to determine hits
    base to-hit: must roll 7 or greater

        NOTE: ENEMY BASE SHOULD MAYBE BE EASIER TO HIT; NEED TO PLAYTEST


################################################################################
ROLL CHARTS:
################################################################################

roll 2D6
   2 :   1/36     36/36     100% will be greater than or equal to
   3 :   2/36     35/36      97% will be greater than or equal to
   4 :   3/36     33/36      92% will be greater than or equal to
   5 :   4/36     30/36      83% will be greater than or equal to
   6 :   5/36     26/36      72% will be greater than or equal to
   7 :   6/36     21/36      58% will be greater than or equal to
   8 :   5/36     15/36      42% will be greater than or equal to
   9 :   4/36     10/36      28% will be greater than or equal to
  10 :   3/36      6/36      17% will be greater than or equal to
  11 :   2/36      3/36       8% will be greater than or equal to
  12 :   1/36      1/36       3% will be greater than or equal to

Calculations:
    scout on LEVEL ground:
        need  8 or better to hit LEVEL    enemy   (42%)
        need 10 or better to hit IN COVER enemy   (17%)
        need 11 or better to hit IN COVER grunt   (8%)
        need  6 or better to hit ELEVATED enemy   (72%)
    scout on ELEVATED ground:
        need  7 or better to hit LEVEL    enemy   (58%)
        need  9 or better to hit IN COVER enemy   (28%)
        need 10 or better to hit IN COVER grunt   (17%)
        need  5 or better to hit ELEVATED enemy   (83%)

    grunt on LEVEL ground:
        need  7 or better to hit LEVEL    enemy   (58%)
        need  9 or better to hit IN COVER enemy   (28%)
        need 10 or better to hit IN COVER grunt   (17%)
        need  5 or better to hit ELEVATED enemy   (83%)
    grunt on ELEVATED ground:
        need  6 or better to hit LEVEL    enemy   (72%)
        need  8 or better to hit IN COVER enemy   (42%)
        need  9 or better to hit IN COVER grunt   (28%)
        need  4 or better to hit ELEVATED enemy   (92%)

    sniper on LEVEL ground:
        need  6 or better to hit LEVEL    enemy   (72%)
        need  8 or better to hit IN COVER enemy   (42%)
        need  9 or better to hit IN COVER grunt   (28%)
        need  4 or better to hit ELEVATED enemy   (92%)
    sniper on ELEVATED ground:
        need  5 or better to hit LEVEL    enemy   (83%)
        need  7 or better to hit IN COVER enemy   (58%)
        need  8 or better to hit IN COVER grunt   (42%)
        need  3 or better to hit ELEVATED enemy   (97%)


